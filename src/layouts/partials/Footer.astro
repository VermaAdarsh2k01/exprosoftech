---
import ImageMod from "@/components/ImageMod.astro";
import config from "@/config/config.json";
import product from "@/config/product.json";
import social from "@/config/social.json";
import { FaEnvelope, FaFacebook, FaPhoneAlt, FaLinkedin, FaTwitter } from "react-icons/fa";
import {
  mainMenu,
  type NavigationLink,
  type ChildNavigationLink,
} from "@/components/Header";
import { sanityClient } from "sanity:client";
const { logo, logo_width, logo_height, title } = config.site;

interface FooterLink {
  name: string;
  url: string;
}

// Create footer links from mainMenu
const footerLinks = mainMenu.flatMap(
  (item: NavigationLink): FooterLink[] =>
    item.hasChildren
      ? item.children?.map(
          (child: ChildNavigationLink): FooterLink => ({
            name: child.name,
            url: child.url,
          })
        ) || []
      : [] // Don't include non-dropdown items like About Us and Contact Us
);

// Footer data query
const footerQuery = `*[_type == "footer"][0] {
    companyName,
    description,
    logo {
      asset->{
        url
      }
    },
    contactInfo {
      phone,
      email
    },
    partnerLogos[] {
      name,
      logo {
        asset->{
          url
        }
      },
      url,
      description
    },
    copyright
  }`;

  const footerData = await sanityClient.fetch(footerQuery);
---

<footer class="bg-[#111827] py-16">
  <div class="max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8">
    <div class="row">
      <!-- Main Footer Content -->
      <div
        class="flex flex-col lg:flex-row justify-between w-full gap-8 lg:gap-16"
      >
        <!-- Left Section: Logo & Description -->
        <div class="lg:w-1/3">
          <div class="space-y-6">
            <div class="flex items-end justify-start gap-4">
              <a href="/" class="block">
                {footerData?.logo?.asset?.url ? (
                  <img
                    src={footerData.logo.asset.url}
                    class="h-auto w-[80px] md:w-[90px]"
                    alt={footerData?.companyName || title}
                  />
                ) : (
                  <ImageMod
                    src="/images/new-logo.png"
                    class="h-auto w-[80px] md:w-[90px]"
                    width={Number(logo_width.replace("px", "")) * 2}
                    height={Number(logo_height.replace("px", "")) * 2}
                    alt={title}
                    format="webp"
                  />
                )}
              </a>
              <p class="text-white text-2xl lg:text-3xl font-bold">{footerData?.companyName}</p>
            </div>
            <p class="text-light/70 max-w-md">
              {footerData?.description}
            </p>

            <!-- Add Social Icons -->
            <div class="flex gap-3 mt-4 items-center justify-start">
              {
                social.main.map((item) => (
                  <a
                    href={item.link}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-light/70 hover:text-primary transition-colors p-1.5"
                  >
                    {item.icon === "FaFacebook" && <FaFacebook size={18} />}
                    {item.icon === "FaTwitter" && <FaTwitter size={18} />}
                    {item.icon === "FaLinkedin" && <FaLinkedin size={18} />}
                    {item.icon === "FaEnvelope" && <FaEnvelope size={18} />}
                  </a>
                ))
              }
            </div>
            <div class="flex flex-col lg:flex-row gap-3 mt-4 items-start lg:items-center justify-start">
              <div class="flex items-center gap-2">
                <FaPhoneAlt/>
                <span class="text-light/70 text-base font-medium">{footerData?.contactInfo?.phone }</span>
              </div>
              <div class="flex items-center gap-2">
                <FaEnvelope/>
                <span class="text-light/70 text-base font-medium">{footerData?.contactInfo?.email }</span>
              </div>
            </div>
            
            {/* Partner Logos Section */}
            {footerData?.partnerLogos && footerData.partnerLogos.length > 0 ? (
              <div class="mt-6 flex flex-col items-start gap-2">
                {footerData.partnerLogos.map((partner: any, index: number) => (
                  <div class="flex flex-col items-start gap-2">
                    {partner.url ? (
                      <a href={partner.url} target="_blank" rel="noopener noreferrer">
                        <img
                          src={partner.logo.asset.url}
                          alt={partner.name}
                          class="h-20 w-auto"
                          loading="lazy"
                        />
                      </a>
                    ) : (
                      <img
                        src={partner.logo.asset.url}
                        alt={partner.name}
                        class="h-20 w-auto"
                        loading="lazy"
                      />
                    )}
                  </div>
                ))}
              </div>
            ) : (
              /* Fallback for when no partner logos are available */
              <div class="mt-6 flex flex-col items-start gap-2">
                <img
                  src="/images/salesforce-logo.png"
                  alt="Salesforce"
                  class="h-20 w-auto"
                  loading="lazy"
                />
              </div>
            )}
          </div>
        </div>

        <!-- Right Section: Links Grid -->
        <div class="lg:w-1/2">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-6">
            <!-- Services Links -->
            <div class="space-y-6">
              <h3 class="text-light text-lg font-medium">Services</h3>
              <ul class="space-y-3">
                {
                  footerLinks.map((link: FooterLink) => (
                    <li>
                      <a
                        href={link.url}
                        class="text-light/70 hover:text-primary transition-colors duration-200"
                      >
                        {link.name}
                      </a>
                    </li>
                  ))
                }
              </ul>
            </div>

            <!-- Products Links -->
            <div class="space-y-6">
              <h3 class="text-light text-lg font-medium">Products</h3>
              <ul class="space-y-3">
                {
                  product.links.map((link) => (
                    <li>
                      <a
                        href={link.link}
                        class="text-light/70 hover:text-primary transition-colors duration-200"
                      >
                        {link.name}
                      </a>
                    </li>
                  ))
                }
              </ul>
            </div>

            <!-- Company Links -->
            <div class="space-y-6">
              <h3 class="text-light text-lg font-medium">Company</h3>
              <ul class="space-y-3">
                <li>
                  <a
                    href="/about/"
                    class="text-light/70 hover:text-primary transition-colors duration-200"
                  >
                    About Us
                  </a>
                </li>
                <li>
                  <a
                    href="/contact/"
                    class="text-light/70 hover:text-primary transition-colors duration-200"
                  >
                    Contact
                  </a>
                </li>
                <li>
                  <a
                    href="/blog/"
                    class="text-light/70 hover:text-primary transition-colors duration-200"
                  >
                    Blogs
                  </a>
                </li>
                <li>
                  <a
                    href="/industries/"
                    class="text-light/70 hover:text-primary transition-colors duration-200"
                  >
                    Industries
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Copyright -->
      <div class="mt-16 pt-8 border-t border-light/10 text-center">
        <p class="text-light/50">
          {footerData?.copyright &&
            <span set:html={footerData.copyright} />
            <a
              href="https://suprdash.com"
              class="text-light/70 hover:text-primary transition-colors"
              target="_blank"
              rel="noopener noreferrer"
            >
              Suprdash
            </a>
          }
        </p>
      </div>
    </div>
  </div>
</footer>
