---
import Base from "@/layouts/Base.astro";
import { Clients } from "../../components/Clients";
import { ServicesBanner } from "@/layouts/components/services/ServicesBanner";
import { ServicesFeatures } from "@/layouts/components/services/ServicesFeatures";
import { ServicesServices } from "@/layouts/components/services/ServicesServices";
import { ServicesBenefits } from "@/layouts/components/services/ServicesBenefits";
import { ServicesProcess } from "@/layouts/components/services/ServicesProcess";
import { ServicesSteps } from "@/layouts/components/services/ServicesSteps";
import { ServicesIndustries } from "@/layouts/components/services/ServicesIndustries";
import ConsultationCTA from "../../components/ConsultationCTA";
import NewFAQ from "../../components/NewFAQ";
import { sanityClient } from "sanity:client";
import DynamicCTA from "../../components/DynamicCTA";
import { CloudSpecializations } from "../../components/CloudSpecializations";

interface Service {
  id: string;
  title: string;
  metaTitle: string;
  metaDescription: string;
  image: string;
  banner: any;
  featuresSection: any;
  servicesSection: any;
  benefitsSection: any;
  processSection: any;
  stepsSection: any;
  industriesSection: any;
  faqSection: any;
  ctaSection: any;
}

const { id } = Astro.params;

// Fetch service data directly
const service = await sanityClient.fetch(`
  *[_type == "dynamicServicePage" && slug.current == $id][0] {
    "id": slug.current,
    title,
    metaTitle,
    metaDescription,
    banner {
      title,
      description,
      buttons[] {
        label,
        link,
        isCalendly
      },
      image {
        "src": src.asset->url,
        alt
      },
      floatingElements[] {
        icon,
        title,
        value,
        color,
        position
      }
    },
    featuresSection {
      heading {
        tagline,
        title,
        description
      },
      features[] {
        title,
        tagline,
        description,
        icon,
        "imageUrl": image.asset->url
      }
    },
    servicesSection {
      heading {
        tagline,
        title,
        description
      },
      services[] {
        title,
        description,
        features
      }
    },
    benefitsSection {
      heading {
        tagline,
        title,
        description
      },
      benefits[] {
        title,
        description,
        icon
      }
    },
    processSection {
      heading {
        tagline,
        title,
        description
      },
      steps[] {
        title,
        description,
        "image": image.asset->url
      }
    },
    stepsSection {
      heading {
        tagline,
        title,
        description
      },
      steps[] {
        title,
        description,
        containers[] {
          title,
          description
        }
      }
    },
    industriesSection {
      heading {
        tagline,
        title,
        description
      },
      industries[] {
        title,
        description,
        icon
      }
    },
    faqSection {
      title,
      pageTitle,
      subtitle,
      description,
      list[] {
        title,
        description,
        active
      }
    },
    ctaSection {
      tagline,
      title,
      subtitle,
      description,
      metrices[] {
        value,
        label,
        icon
      },
      buttonText,
      image {
        "src": src.asset->url,
        alt
      }
    }
  }
`, { id });

if (!service) {
  return Astro.redirect('/404');
}
---

<Base
  title={service.title}
  meta_title={service.metaTitle}
  description={service.metaDescription}
  image={service.image}
>
  <ServicesBanner client:load content={service.banner} />
  <!-- <Clients client:load /> -->
  <!-- <ServicesFeatures 
    client:visible 
    features={service.featuresSection.features} 
    heading={service.featuresSection.heading}
  /> -->
  <!-- <ServicesServices 
    client:visible 
    services={service.servicesSection.services} 
    heading={service.servicesSection.heading}
  /> -->
  <CloudSpecializations client:visible />
  <ServicesSteps 
    client:visible 
    process={service.stepsSection?.steps || []} 
    heading={service.stepsSection?.heading}
  />
  <ServicesBenefits 
    client:visible 
    benefits={service.benefitsSection?.benefits} 
    heading={service.benefitsSection?.heading}
  />

  <!-- <ServicesProcess 
    client:visible 
    process={service.processSection.steps} 
    heading={service.processSection.heading}
  /> -->
  
  <!-- <ServicesIndustries 
    client:visible 
    industries={service.industriesSection.industries} 
    heading={service.industriesSection.heading}
  /> -->
  <DynamicCTA client:visible ctaContent={service.ctaSection} />
  <NewFAQ client:visible Faq={[service.faqSection]} />
</Base>
